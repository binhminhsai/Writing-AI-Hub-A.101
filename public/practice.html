<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice Writing | Writing AI Hub</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style>
        /* Inline override styles to ensure text visibility */
        body, p, h1, h2, h3, h4, h5, h6, .nav-link, .logo, .footer-logo, .btn, label, textarea {
            color: var(--app-text-color, #374151) !important;
        }
        body {
            background-color: var(--app-background, #f0fdfc) !important;
        }
        [data-bs-theme="dark"] .app-header, [data-bs-theme="dark"] .practice-card,
        [data-bs-theme="dark"] .app-footer, [data-bs-theme="dark"] .suggestion-card {
            background-color: white !important;
        }
        .practice-card, .suggestion-card {
            background-color: white !important;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .question-container {
            background-color: #f8f9fa !important;
            border-left: 4px solid #14b8a6;
            padding: 1rem;
            border-radius: 0 6px 6px 0;
        }
        .nav-tab {
            color: #6b7280 !important;
        }
        .nav-tab.active {
            color: var(--app-primary-color, #14b8a6) !important;
            border-bottom: 2px solid var(--app-primary-color, #14b8a6);
        }
        textarea {
            background-color: white !important;
            border: 1px solid #d1d5db !important;
        }
        .suggestion-item {
            background-color: #f8f9fa !important;
            border-left: 3px solid #14b8a6;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0 4px 4px 0;
        }
    </style>
    <style>
        /* Styles specific to the practice page */
        .practice-container {
            display: flex;
            gap: 2rem;
        }
        
        .writing-area {
            flex: 2;
        }
        
        .support-panel {
            flex: 1;
            position: sticky;
            top: 2rem;
            align-self: flex-start;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .prompt-card {
            border-left: 4px solid var(--app-primary-color);
        }
        
        .timer-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
        }
        
        .timer {
            font-size: 1.5rem;
            font-weight: 600;
            color: #374151;
        }
        
        .essay-textarea {
            width: 100%;
            min-height: 400px;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-family: var(--app-font-family);
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
        }
        
        .word-count {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #6b7280;
            text-align: right;
        }
        
        .nav-tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1rem;
        }
        
        .nav-tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #6b7280;
        }
        
        .nav-tab.active {
            border-bottom-color: var(--app-primary-color);
            color: var(--app-primary-color);
            font-weight: 500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .suggestion-item {
            margin-bottom: 0.75rem;
            padding-left: 1.25rem;
            position: relative;
        }
        
        .suggestion-item:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--app-primary-color);
        }
        
        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background-color: #e5e7eb;
        }
        
        .btn-lg {
            padding: 0.875rem 2rem;
            font-size: 1.125rem;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #374151;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #374151 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="container header-container">
            <a href="/" class="logo">
                <i class="fas fa-globe"></i>
                Writing AI Hub
            </a>
            <div class="nav-menu">
                <div class="nav-links">
                    <a href="/" class="nav-link">Home</a>
                    <a href="/setting.html" class="nav-link active">Practice</a>
                </div>
                <a href="/account.html" class="btn-account">My Account</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <div class="practice-header">
                <a href="/setting.html" class="back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m12 19-7-7 7-7"></path>
                        <path d="M19 12H5"></path>
                    </svg>
                    Back to Settings
                </a>
                
                <h1 class="page-title">Practice Writing</h1>
            </div>
            
            <div class="practice-container">
                <!-- Writing Area -->
                <div class="writing-area">
                    <!-- Question Card -->
                    <div class="card prompt-card">
                        <h3>Writing Prompt:</h3>
                        <p id="question-display"></p>
                    </div>
                    
                    <!-- Timer and Writing Card -->
                    <div class="card timer-card">
                        <div>
                            <span>Time Remaining:</span>
                            <div id="timer" class="timer">00:00:00</div>
                        </div>
                        <div class="tooltip">
                            <button id="toggle-timer" class="btn btn-secondary">
                                <i class="fas fa-pause" id="timer-icon"></i>
                            </button>
                            <span class="tooltiptext">Pause/Resume Timer</span>
                        </div>
                    </div>
                    
                    <!-- Writing Card -->
                    <div class="card">
                        <textarea id="essay-input" class="essay-textarea" placeholder="Start writing your essay here..."></textarea>
                        <div class="word-count"><span id="word-count">0</span> words written</div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button id="save-draft" class="btn btn-secondary">
                            <i class="fas fa-save"></i>
                            Save Draft
                        </button>
                        <button id="get-feedback" class="btn btn-teal btn-lg">
                            Submit for Feedback
                        </button>
                    </div>
                </div>
                
                <!-- Support Panel -->
                <div class="support-panel">
                    <!-- Resources Card -->
                    <div class="card">
                        <h3>Writing Resources</h3>
                        
                        <div class="nav-tabs">
                            <div class="nav-tab active" data-tab="outline">Outline</div>
                            <div class="nav-tab" data-tab="vocab">Vocabulary</div>
                            <div class="nav-tab" data-tab="sentences">Sentences</div>
                        </div>
                        
                        <!-- Outline Tab -->
                        <div id="outline-tab" class="tab-content active">
                            <p>Suggested structure for your essay:</p>
                            <div id="outline-content"></div>
                        </div>
                        
                        <!-- Vocabulary Tab -->
                        <div id="vocab-tab" class="tab-content">
                            <p>Useful vocabulary for this topic:</p>
                            <div id="vocab-content"></div>
                        </div>
                        
                        <!-- Sentences Tab -->
                        <div id="sentences-tab" class="tab-content">
                            <p>Useful sentence patterns:</p>
                            <div id="sentences-content"></div>
                        </div>
                    </div>
                    
                    <!-- Tips Card -->
                    <div class="card">
                        <h3>Writing Tips</h3>
                        <ul>
                            <li>Aim for at least 250 words for Task 2 (150 for Task 1)</li>
                            <li>Use paragraphs to structure your essay clearly</li>
                            <li>Include an introduction, 2-3 body paragraphs, and conclusion</li>
                            <li>Support your points with examples or explanations</li>
                            <li>Use a range of vocabulary and grammatical structures</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="container footer-container">
            <a href="/" class="footer-logo">
                <i class="fas fa-globe"></i>
                Writing AI Hub
            </a>
            <div class="copyright">
                © 2025 Writing AI Hub. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we have essay data in localStorage
            const savedData = localStorage.getItem('essayData');
            if (!savedData) {
                alert('No question data found. Please generate a question first.');
                window.location.href = '/setting.html';
                return;
            }
            
            // Parse the saved data
            const essayData = JSON.parse(savedData);
            
            // Populate the page with the data
            document.getElementById('question-display').textContent = essayData.question;
            
            // Set up tabs
            const outlineContent = document.getElementById('outline-content');
            const vocabContent = document.getElementById('vocab-content');
            const sentencesContent = document.getElementById('sentences-content');
            
            // Format and display outline
            if (essayData.outline) {
                // Support multiple line break formats
                const outlineText = essayData.outline.replace(/\\n/g, '\n');
                const outlinePoints = outlineText.split('\n').filter(line => line.trim() !== '');
                let outlineHTML = '';
                outlinePoints.forEach(point => {
                    outlineHTML += `<div class="suggestion-item">${point}</div>`;
                });
                outlineContent.innerHTML = outlineHTML || '<div class="suggestion-item">No outline available</div>';
            }
            
            // Format and display vocabulary
            if (essayData.vocabulary_suggestions) {
                // Support multiple line break formats
                const vocabText = essayData.vocabulary_suggestions.replace(/\\n/g, '\n');
                const vocabPoints = vocabText.split('\n').filter(line => line.trim() !== '');
                let vocabHTML = '';
                vocabPoints.forEach(point => {
                    vocabHTML += `<div class="suggestion-item">${point}</div>`;
                });
                vocabContent.innerHTML = vocabHTML || '<div class="suggestion-item">No vocabulary suggestions available</div>';
            }
            
            // Format and display sentences
            if (essayData.sentence_suggestions) {
                // Support multiple line break formats
                const sentenceText = essayData.sentence_suggestions.replace(/\\n/g, '\n');
                const sentencePoints = sentenceText.split('\n').filter(line => line.trim() !== '');
                let sentenceHTML = '';
                sentencePoints.forEach(point => {
                    sentenceHTML += `<div class="suggestion-item">${point}</div>`;
                });
                sentencesContent.innerHTML = sentenceHTML || '<div class="suggestion-item">No sentence suggestions available</div>';
            }
            
            // Tab switching
            const tabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Setup timer
            let timeLimit = essayData.timeLimit || 30; // Default to 30 minutes if not set
            let totalSeconds = timeLimit * 60;
            let timerInterval = null;
            let timerRunning = false;
            
            function updateTimerDisplay() {
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                
                const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('timer').textContent = display;
                
                if (totalSeconds <= 0) {
                    clearInterval(timerInterval);
                    alert('Time\'s up! Please submit your essay for feedback.');
                }
            }
            
            function startTimer() {
                timerRunning = true;
                timerInterval = setInterval(function() {
                    if (totalSeconds > 0) {
                        totalSeconds--;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                    }
                }, 1000);
                document.getElementById('timer-icon').className = 'fas fa-pause';
            }
            
            function pauseTimer() {
                timerRunning = false;
                clearInterval(timerInterval);
                document.getElementById('timer-icon').className = 'fas fa-play';
            }
            
            // Initialize timer display
            updateTimerDisplay();
            
            // Start the timer automatically
            startTimer();
            
            // Toggle timer button
            document.getElementById('toggle-timer').addEventListener('click', function() {
                if (timerRunning) {
                    pauseTimer();
                } else {
                    startTimer();
                }
            });
            
            // Word counter
            const essayInput = document.getElementById('essay-input');
            const wordCount = document.getElementById('word-count');
            
            function countWords(text) {
                return text.trim().split(/\s+/).filter(word => word !== '').length;
            }
            
            essayInput.addEventListener('input', function() {
                const count = countWords(this.value);
                wordCount.textContent = count;
            });
            
            // Save draft button
            document.getElementById('save-draft').addEventListener('click', function() {
                const essayText = essayInput.value;
                if (essayText.trim() === '') {
                    alert('There is no essay to save.');
                    return;
                }
                
                // Save to local storage
                localStorage.setItem('essayDraft', essayText);
                alert('Essay draft saved successfully.');
            });
            
            // Load draft if it exists
            const savedDraft = localStorage.getItem('essayDraft');
            if (savedDraft) {
                essayInput.value = savedDraft;
                wordCount.textContent = countWords(savedDraft);
            }
            
            // Get feedback button
            document.getElementById('get-feedback').addEventListener('click', function() {
                const essayText = essayInput.value;
                if (essayText.trim() === '') {
                    alert('Please write an essay before submitting for feedback.');
                    return;
                }
                
                if (countWords(essayText) < 150) {
                    const confirmed = confirm('Your essay is quite short. It\'s recommended to write at least 250 words for Task 2 (150 for Task 1). Do you still want to submit?');
                    if (!confirmed) return;
                }
                
                // Prepare data for submission
                const submissionData = {
                    essay: essayText,
                    question: essayData.question,
                    types: essayData.task_type || 'TASK2'
                };
                
                // Also store submission data for grading page
                localStorage.setItem('gradingData', JSON.stringify(submissionData));
                
                // Save current essay to localStorage in case of page navigation
                localStorage.setItem('essayDraft', essayText);
                
                // Navigate to the grading page with query parameters
                window.location.href = '/grading.html';
            });
        });
    </script>
</body>
</html>